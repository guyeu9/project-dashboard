# 测试环境部署指南

## 当前问题

测试环境（URL: https://d639ecc3-037f-4612-8cc4-c74acb766d7b.dev.coze.site/）报错：

```
Failed to save default providers to database:
Error: API POST /ai/providers failed: 404

[vite] failed to connect to websocket
```

**原因**：测试环境还在使用旧版本的 server.ts，没有实现 API 路由。

## 解决方案：重新部署测试环境

### 方法 1：在扣子平台重新部署（推荐）

1. **登录扣子开发者平台**
   - 访问：https://www.coze.cn/

2. **进入项目管理**
   - 找到当前项目
   - 进入项目详情页面

3. **触发重新部署**
   - 找到"部署"或"发布"按钮
   - 点击"重新部署"或"重新构建"
   - 等待部署完成（通常需要 2-5 分钟）

4. **验证部署**
   - 访问测试环境 URL
   - 检查是否还有错误
   - 查看"已暂停"卡片是否显示

### 方法 2：如果有 CI/CD 流水线

1. **进入 CI/CD 配置**
   - 找到项目的 CI/CD 配置
   - 查看测试环境的部署配置

2. **手动触发部署**
   - 点击"手动触发"或"立即部署"
   - 选择"测试环境"
   - 等待部署完成

3. **查看部署日志**
   - 检查是否有验证日志：
     ```
     [INFO] dist directory verified, found 1 JS files
     [INFO] Latest JS file: index-xxxxxxx.js
     ```

### 方法 3：联系技术支持

如果以上方法都无效，请联系扣子技术支持，提供以下信息：

1. **项目信息**：
   - 项目名称
   - 项目 ID
   - 测试环境 URL

2. **错误信息**：
   - 完整的错误日志
   - 出错时间

3. **期望行为**：
   - 应该能够正常访问 API
   - 应该显示"已暂停"卡片

## 预期的正确行为

部署成功后，测试环境应该：

### 1. API 正常工作
访问 `https://d639ecc3-037f-4612-8cc4-c74acb766d7b.dev.coze.site/api/ai/providers`
- ✅ 返回 JSON 数组（可能是空数组 `[]`）
- ❌ 不返回 404
- ❌ 不返回 HTML 页面

### 2. 首页功能正常
- ✅ 显示 4 个状态卡片
- ✅ "已暂停"卡片使用黄色渐变
- ✅ 通知过滤正常工作

### 3. 设置页面正常
- ✅ AI 配置可以加载
- ✅ 不再显示 API 404 错误
- ✅ 不再显示 SyntaxError

## 部署后的验证步骤

### 1. 检查浏览器控制台
打开浏览器开发者工具（F12），查看：
- ✅ 没有 API 404 错误
- ✅ 没有 SyntaxError
- ✅ WebSocket 连接正常

### 2. 检查功能
- ✅ 首页显示正常
- ✅ 可以导入导出数据
- ✅ 可以设置 AI 配置
- ✅ 通知系统正常工作

### 3. 检查网络请求
在开发者工具的 Network 标签中：
- ✅ `/api/ai/config` 返回 200
- ✅ `/api/ai/providers` 返回 200
- ✅ `/api/data` 返回 200

## 常见问题

### Q: 为什么测试环境还是旧的代码？
A: 测试环境还没有重新部署，需要手动触发部署。

### Q: 部署后还是报错怎么办？
A: 检查部署日志，确认是否拉取了最新代码。如果日志中缺少验证信息，说明使用的是旧代码。

### Q: 需要清理缓存吗？
A: 在扣子平台的部署选项中，如果有"清除缓存"选项，建议勾选。

### Q: 部署需要多长时间？
A: 通常需要 2-5 分钟，取决于项目大小和网络情况。

## 联系支持

如果问题仍然存在，请联系扣子技术支持：
- 提供项目 ID 和 URL
- 提供完整的错误日志
- 说明已经尝试过的方法
