# 互联网联调排期管理平台

基于OpenSpec规范驱动开发（SDD）的极简主义联调指挥台。

## 技术栈

- **前端框架**: React 18 + TypeScript
- **构建工具**: Vite 5
- **UI组件库**: Ant Design 5
- **状态管理**: Zustand 4
- **路由**: React Router DOM 6
- **日期处理**: Day.js 1
- **HTTP客户端**: Axios 1

## 项目结构

```
src/
├── components/          # 可复用组件
│   ├── Layout/        # 主布局组件（侧边栏导航）
│   └── MasterGantt/    # 聚合甘特图组件
├── pages/             # 页面组件
│   └── Dashboard/      # 项目全景仪表板
├── store/             # 状态管理
│   ├── useStore.ts     # Zustand全局状态
│   └── mockData.ts     # 模拟数据
├── types/             # TypeScript类型定义
│   └── index.ts
├── App.tsx            # 应用根组件
├── main.tsx           # 应用入口
└── index.css          # 全局样式
```

## 已实现功能

### ✅ 项目全景仪表板（create-project-dashboard）

根据OpenSpec规范，已完成以下功能：

1. **项目全景仪表板布局** ✅
   - 顶部核心指标卡片（并行项目、延期/风险、待开始）
   - 项目状态筛选器（支持多选）
   - 响应式布局设计

2. **聚合甘特图组件** ✅
   - Y轴显示项目列表
   - X轴显示时间轴（支持月视图）
   - 项目进度条颜色标识（绿色正常、红色延期/风险）
   - 悬浮详情展示（合作方、开发人员、测试人员、负责人）
   - 点击项目条下钻到详情页

3. **可滑动日期甘特图** ✅
   - 左右滑动浏览不同日期范围
   - 上/下个月切换按钮
   - "今天"快速定位按钮
   - 北京时区红线标示当前日期

4. **任务类型管理** ✅
   - 预定义6种任务类型（开发排期、开发联调、测试排期、测试联调、产品UAT、上线）
   - 每种类型配置不同颜色
   - 支持启用/禁用状态

### ✅ 项目详情页（create-project-detail）

根据OpenSpec规范，已完成以下功能：

1. **项目元数据展示** ✅
   - 项目核心属性展示（状态、进度、负责人、PMO、产品经理等）
   - 快速编辑入口

2. **执行甘特图组件** ✅
   - 细粒度任务排期展示
   - 支持任务新增、编辑与删除
   - 任务进度实时更新

3. **修改历史记录** ✅
   - 任务变更追踪（暂存于本地状态）

### ✅ 核心功能增强

- **多维数据导出**：支持 Excel (.xlsx) 和 JSON 格式导出。Excel 导出包含项目汇总页签及每个项目的独立详细 Sheet（包含任务明细、每日进度记录等），结构清晰。
- **智能风险预警**：自动汇总任务风险到项目维度。若某天记录了“风险”或“延期”，甘特图项目行对应日期将显示红色感叹号（!），悬停可查看详细备注。
- **自动定位与贯穿线**：进入界面自动定位至“当前日期前 5 天”，红色垂直线贯穿全图，清晰标识今日位置。
- **高性能甘特图**：支持 120 天超长日期轴自由滑动，不受月份切换限制，支持触摸拖拽优化。
- **UI/UX 深度优化**：
  - 纯黑高对比度字体，解决白色背景下阅读困难。
  - 项目标题加粗突出显示，左侧蓝色边框引导。
  - 任务条采用圆角 Tag 样式，颜色与类型挂钩。
  - 紧凑型行高设计，提升单屏信息密度。
  - 周末绿色辨识，今日红色背景。

### ✅ 基础功能

1. **智能文本解析** ✅
   - 支持特定格式的排期文本一键解析
   - 自动识别阶段、日期和人员（@提及）

2. **极简主义表单设计** ✅
   - 大幅减少必填项限制，提升录入效率
   - 项目详情：仅“项目名称”必填
   - 任务编辑：仅“任务类型”、“开始日期”、“结束日期”必填
   - 每日进度：仅“日期”、“状态”必填

## 待实现功能

根据OpenSpec规范，以下功能待开发：

### 🔥 资源排期热力图（create-resource-heatmap）
- [ ] 人员任务分配可视化
- [ ] 任务堆积热力图
- [ ] 瓶颈识别算法
- [ ] 侧边面板展示任务详情

### 📊 项目管理界面（create-project-management）
- [ ] 项目列表展示（卡片/列表布局切换）
- [ ] 进度跟踪展示
- [ ] 筛选和排序功能
- [ ] 快速查看功能
- [ ] 批量操作功能

## 智能解析格式

系统支持以下文本格式的智能解析：

```
开发排期：12.18-1.14 
开发联调（期望与合作方):1.19-1.21 @王靖博-业务交付中心（常用） @邓晓旭  
测试排期：1.12-1.23 
测试联调（期望与合作方）：1.26-1.30 @史宁博  
产品UAT：1.29-1.30 
一批次上线时间：1.30
```

**解析规则**：
- 阶段识别：`/(开发排期|开发联调|测试排期|测试联调|产品UAT|上线)/`
- 时间识别：`/(\d{1,2}\.\d{1,2})-(\d{1,2}\.\d{1,2})/`
- 人员识别：`/@([^\s]+)/g`

## 快速开始

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建生产版本
npm run build

# 本地预览生产构建（仅前端，使用 Vite 内置预览）
npm run preview

# 启动一体化生产服务器（前端静态资源 + 数据接口）
npm run serve:static
```

## 部署与数据一致性

本项目的所有项目/任务/每日进度数据，都通过一个统一的数据接口 `/api/data` 持久化到服务端的 `data/project-data.json` 文件中。只要所有用户访问的前端配置到同一个数据接口地址，所有人看到和修改的数据就是完全一致的。

### 本地开发环境

- 运行 `npm run dev` 时，Vite 开发服务器会挂载一个本地数据接口：
  - 接口地址：`http://localhost:3000/api/data`
  - 数据文件：自动写入项目根目录下的 `data/project-data.json`
- 所有浏览器打开 `http://localhost:3000`，共享同一个 `project-data.json`，数据保持一致。

### 生产环境一体化部署（推荐）

1. 构建前端静态资源：

```bash
npm run build
```

2. 启动自带的生产服务器：

```bash
npm run serve:static
```

- 服务器行为：
  - 监听端口：`PORT` 环境变量或默认 `4173`
  - 静态资源目录：`dist/`
  - 数据接口：`/api/data`（读写 `data/project-data.json`）
  - 支持跨域访问（已设置 CORS 头），方便前端托管在其他域名时复用同一个数据服务。
- 效果：
  - 所有访问该服务器域名的用户（无论浏览器/电脑）都会共享同一份 `project-data.json`，即所有项目与甘特图数据完全统一。

### 静态站点一键部署平台（如 Vercel / Netlify）

很多平台支持“一键部署前端静态站点”，但**不会自动提供持久化数据库**。为保证数据统一，本项目采用“前后端分离部署”的方式：

- 步骤 1：部署数据服务（后端）
  - 将 `server.mjs` 和 `data/` 放到任意支持 Node.js 的平台（如 Render、Railway、自建服务器）。
  - 启动命令示例：
    - `node server.mjs`
  - 得到一个固定的 API 根地址，例如：`https://your-api.example.com`。

- 步骤 2：配置前端环境变量并构建
  - 在一键部署平台中，设置环境变量：
    - `VITE_API_BASE_URL=https://your-api.example.com`
  - 构建前端：
    - 平台会自动执行 `npm run build`，Vite 会把 `VITE_API_BASE_URL` 编译进前端代码。
  - 前端运行时会请求：
    - `https://your-api.example.com/api/data`

- 步骤 3：部署前端静态资源
  - 平台会将 `dist/` 作为静态站点托管。
  - 所有访问该前端站点的用户，都会通过同一个 `https://your-api.example.com/api/data` 接口读写数据。

> 结论：在“一键部署”场景下，只要所有前端实例的 `VITE_API_BASE_URL` 配置为同一个后端域名，数据就会全部汇聚到同一份 `project-data.json` 中，所有人看到和修改的是统一的数据。

## OpenSpec规范

所有功能开发均遵循OpenSpec规范驱动开发流程：

1. **提案阶段** - 创建proposal.md定义变更范围
2. **任务分解** - 创建tasks.md拆解开发任务
3. **执行验证** - 按规范逐步实现并验证

当前OpenSpec变更提案：
- ✅ `create-project-dashboard` - 已验证通过
- ✅ `create-project-detail` - 已验证通过
- ✅ `create-data-management` - 已验证通过
- ⏳ `create-resource-heatmap` - 待开发
- ⏳ `create-project-management` - 待开发

## 设计理念

**极简主义联调指挥台**
- 不做复杂的研发全流程管理（DevOps）
- 只做排期可视化与资源调度
- 一切为了"按时上线"

**核心价值**
- 🎯 上帝视角 - 多项目聚合甘特图
- ⚡ 极速模式 - 双击编辑，实时保存
- 🔍 瓶颈识别 - 资源排期热力图
- 🤖 智能解析 - 一键导入排期数据

## 许可证

MIT
