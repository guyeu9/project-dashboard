# 互联网联调排期管理平台

基于OpenSpec规范驱动开发（SDD）的极简主义联调指挥台。

## 技术栈

- **前端框架**: React 18 + TypeScript
- **构建工具**: Vite 5
- **UI组件库**: Ant Design 5
- **状态管理**: Zustand 4
- **路由**: React Router DOM 6
- **日期处理**: Day.js 1
- **HTTP客户端**: Axios 1

## 项目结构

```
src/
├── components/          # 可复用组件
│   ├── Layout/        # 主布局组件（侧边栏导航）
│   ├── MasterGantt/    # 聚合甘特图组件
│   ├── ExecutionGantt/ # 执行甘特图组件
│   └── ...
├── pages/             # 页面组件
│   ├── Dashboard/      # 项目全景仪表板
│   ├── ProjectManagement/ # 项目管理
│   ├── ProjectDetail/  # 项目详情页
│   ├── ResourceSchedule/ # 资源排期热力图
│   └── DataManagement/ # 数据管理
├── store/             # 状态管理
│   ├── useStore.ts     # Zustand全局状态
│   ├── mockData.ts     # 模拟数据
│   └── ...
├── types/             # TypeScript类型定义
│   └── index.ts
├── utils/             # 工具函数
├── App.tsx            # 应用根组件
├── main.tsx           # 应用入口
└── index.css          # 全局样式
```

## 已实现功能

### ✅ 项目全景仪表板（create-project-dashboard）

根据OpenSpec规范，已完成以下功能：

1. **项目全景仪表板布局** ✅
   - 顶部核心指标卡片（并行项目、延期/风险、待开始）
   - 项目状态筛选器（支持多选）
   - 响应式布局设计

2. **聚合甘特图组件** ✅
   - Y轴显示项目列表
   - X轴显示时间轴（支持月视图）
   - 项目进度条颜色标识（绿色正常、红色延期/风险）
   - 悬浮详情展示（合作方、开发人员、测试人员、负责人）
   - 点击项目条下钻到详情页

3. **可滑动日期甘特图** ✅
   - 左右滑动浏览不同日期范围
   - 上/下个月切换按钮
   - "今天"快速定位按钮
   - 北京时区红线标示当前日期

4. **任务类型管理** ✅
   - 预定义6种任务类型（开发排期、开发联调、测试排期、测试联调、产品UAT、上线）
   - 每种类型配置不同颜色
   - 支持启用/禁用状态

### ✅ 项目详情页（create-project-detail）

根据OpenSpec规范，已完成以下功能：

1. **项目元数据展示** ✅
   - 项目核心属性展示（状态、进度、负责人、PMO、产品经理等）
   - 快速编辑入口

2. **执行甘特图组件** ✅
   - 细粒度任务排期展示
   - 支持任务新增、编辑与删除
   - 任务进度实时更新

3. **修改历史记录** ✅
   - 任务变更追踪（暂存于本地状态）

### ✅ 项目管理（create-project-management）

根据OpenSpec规范，已完成以下功能：

1. **项目列表展示** ✅
   - 支持列表/卡片布局切换
   - 项目核心信息展示
   - 快速操作入口

2. **项目创建与编辑** ✅
   - 统一项目创建表单
   - 支持项目基本信息编辑
   - 项目状态管理

3. **进度跟踪展示** ✅
   - 项目进度可视化
   - 状态筛选与排序

### ✅ 资源排期热力图（create-resource-heatmap）

根据OpenSpec规范，已完成以下功能：

1. **资源热力图可视化** ✅
   - 人员任务分配可视化
   - 任务堆积热力图
   - 瓶颈识别算法
   - 侧边面板展示任务详情

### ✅ 数据管理（create-data-management）

根据OpenSpec规范，已完成以下功能：

1. **智能文本解析功能** ✅
   - 支持特定格式的排期文本一键解析
   - 自动识别阶段、日期和人员（@提及）
   - 解析结果预览

2. **数据导入导出** ✅
   - 支持Excel (.xlsx)和JSON格式导出
   - Excel导出包含项目汇总页签及每个项目的独立详细Sheet
   - 支持JSON格式导入

### ✅ 通知系统（notification-system）

根据OpenSpec规范，已完成以下功能：

1. **全局通知中心** ✅
   - 通知列表展示
   - 未读通知标记
   - 通知详情查看

### ✅ 核心功能增强

- **多维数据导出**：支持 Excel (.xlsx) 和 JSON 格式导出。Excel 导出包含项目汇总页签及每个项目的独立详细 Sheet（包含任务明细、每日进度记录等），结构清晰。
- **智能风险预警**：自动汇总任务风险到项目维度。若某天记录了"风险"或"延期"，甘特图项目行对应日期将显示红色感叹号（!），悬停可查看详细备注。
- **自动定位与贯穿线**：进入界面自动定位至"当前日期前 5 天"，红色垂直线贯穿全图，清晰标识今日位置。
- **高性能甘特图**：支持 120 天超长日期轴自由滑动，不受月份切换限制，支持触摸拖拽优化。
- **UI/UX 深度优化**：
  - 纯黑高对比度字体，解决白色背景下阅读困难。
  - 项目标题加粗突出显示，左侧蓝色边框引导。
  - 任务条采用圆角 Tag 样式，颜色与类型挂钩。
  - 紧凑型行高设计，提升单屏信息密度。
  - 周末绿色辨识，今日红色背景。

### ✅ 基础功能

1. **智能文本解析** ✅
   - 支持特定格式的排期文本一键解析
   - 自动识别阶段、日期和人员（@提及）

2. **极简主义表单设计** ✅
   - 大幅减少必填项限制，提升录入效率
   - 项目详情：仅"项目名称"必填
   - 任务编辑：仅"任务类型"、"开始日期"、"结束日期"必填
   - 每日进度：仅"日期"、"状态"必填

3. **数据持久化修复** ✅
   - 修复清除数据后刷新页面重新显示系统初始化数据问题
   - 修复新建数据后刷新页面数据丢失问题

4. **管理员登录功能** ✅
   - 支持管理员登录验证，确保系统安全性
   - 未登录用户仅可查看项目信息，无法进行增删改操作
   - 修复登录按钮点击无反应问题，优化用户体验

5. **任务通知系统** ✅
   - 智能任务提醒机制：每个任务发送2次提醒（提前一天+当天任意时间）
   - 通知中心统一管理：支持未读红点提示、标记已读、删除通知
   - 通知内容清晰：包含任务名称、项目名称、开始时间、提醒类型
   - 通知持久化：保存到 localStorage，刷新不丢失
   - 智能去重：确保每个任务只发送2次通知，不会重复

6. **AI配置持久化** ✅
   - AI配置（系统提示词、服务提供商）持久化到数据库
   - 避免重新部署后配置丢失，提升系统稳定性
   - 支持动态配置切换，无需重启服务

7. **项目状态管理** ✅
   - 新增"暂停"状态，灵活控制项目显示
   - 暂停项目不在首页甘特图显示，保持界面简洁
   - 支持项目状态随时切换，适应项目变化需求

8. **历史操作记录** ✅
   - 自动记录所有项目、任务的创建、更新、删除操作
   - 历史记录持久化到数据库，支持查询追溯
   - 修复历史记录保存逻辑，确保数据完整性

## 快速开始

### 环境要求

- Node.js 24+
- pnpm 包管理器

### 安装与运行

```bash
# 安装依赖
pnpm install

# 启动开发服务器（带热更新）
pnpm run dev

# 构建生产版本
pnpm run build

# 本地预览生产构建（仅前端，使用 Vite 内置预览）
pnpm run preview

# 启动一体化生产服务器（前端静态资源 + 数据接口）
pnpm run serve:static
```

### 首次使用

1. **启动服务**：运行 `pnpm run dev` 启动开发服务器
2. **打开网站**：访问 http://localhost:5000
3. **登录系统**：使用管理员账号登录
4. **创建项目**：在"项目管理"页面创建第一个项目
5. **管理任务**：在项目详情页添加和管理任务
6. **查看通知**：留意右上角通知图标，接收任务提醒

### 常见问题

**Q: 通知不显示怎么办？**  
A: 确保已登录系统，检查任务开始日期是否在未来。通知会在任务开始前一天或当天自动生成。

**Q: 如何清空所有数据？**  
A: 在"数据管理"页面，点击"清空所有数据"按钮可以重置系统。

**Q: 如何备份项目数据？**  
A: 在"数据管理"页面，点击"导出数据"按钮可以导出 Excel 或 JSON 格式的数据。
```

### 首次使用说明

1. **启动服务**
   - 执行 `pnpm run dev` 启动开发服务器
   - 默认访问地址：`http://localhost:3000`
   - 数据接口：`http://localhost:3000/api/data`

2. **管理员登录**
   - 点击右上角"登录"按钮
   - 使用管理员账号登录（详情请咨询系统管理员）
   - 登录成功后即可进行项目创建、编辑、删除等操作

3. **创建项目**
   - 进入"项目管理"页面
   - 点击"新建项目"按钮
   - 填写项目基本信息（项目名称必填）
   - 点击"确定"完成创建

4. **管理任务**
   - 进入项目详情页
   - 点击"新增任务"按钮
   - 填写任务信息（任务类型、开始日期、结束日期必填）
   - 支持使用智能文本解析快速导入任务

5. **查看通知**
   - 右上角通知图标显示未读通知数量
   - 点击查看任务提醒
   - 系统会在任务开始前一天及当天早上9点自动提醒

## 部署与数据一致性

本项目的所有项目/任务/每日进度数据，都通过一个统一的数据接口 `/api/data` 持久化到服务端的 `data/project-data.json` 文件中。只要所有用户访问的前端配置到同一个数据接口地址，所有人看到和修改的数据就是完全一致的。

### 本地开发环境

- 运行 `npm run dev` 时，Vite 开发服务器会挂载一个本地数据接口：
  - 接口地址：`http://localhost:3000/api/data`
  - 数据文件：自动写入项目根目录下的 `data/project-data.json`
- 所有浏览器打开 `http://localhost:3000`，共享同一个 `project-data.json`，数据保持一致。

### 生产环境一体化部署（推荐）

1. 构建前端静态资源：

```bash
npm run build
```

2. 启动自带的生产服务器：

```bash
npm run serve:static
```

- 服务器行为：
  - 监听端口：`PORT` 环境变量或默认 `4173`
  - 静态资源目录：`dist/`
  - 数据接口：`/api/data`（读写 `data/project-data.json`）
  - 支持跨域访问（已设置 CORS 头），方便前端托管在其他域名时复用同一个数据服务。
- 效果：
  - 所有访问该服务器域名的用户（无论浏览器/电脑）都会共享同一份 `project-data.json`，即所有项目与甘特图数据完全统一。

### 静态站点一键部署平台（如 Vercel / Netlify）

很多平台支持"一键部署前端静态站点"，但**不会自动提供持久化数据库**。为保证数据统一，本项目采用"前后端分离部署"的方式：

- 步骤 1：部署数据服务（后端）
  - 将 `server.mjs` 和 `data/` 放到任意支持 Node.js 的平台（如 Render、Railway、自建服务器）。
  - 启动命令示例：
    - `node server.mjs`
  - 得到一个固定的 API 根地址，例如：`https://your-api.example.com`。

- 步骤 2：配置前端环境变量并构建
  - 在一键部署平台中，设置环境变量：
    - `VITE_API_BASE_URL=https://your-api.example.com`
  - 构建前端：
    - 平台会自动执行 `npm run build`，Vite 会把 `VITE_API_BASE_URL` 编译进前端代码。
  - 前端运行时会请求：
    - `https://your-api.example.com/api/data`

- 步骤 3：部署前端静态资源
  - 平台会将 `dist/` 作为静态站点托管。
  - 所有访问该前端站点的用户，都会通过同一个 `https://your-api.example.com/api/data` 接口读写数据。

> 结论：在"一键部署"场景下，只要所有前端实例的 `VITE_API_BASE_URL` 配置为同一个后端域名，数据就会全部汇聚到同一份 `project-data.json` 中，所有人看到和修改的是统一的数据。

## OpenSpec规范

所有功能开发均遵循OpenSpec规范驱动开发流程：

1. **提案阶段** - 创建proposal.md定义变更范围
2. **任务分解** - 创建tasks.md拆解开发任务
3. **执行验证** - 按规范逐步实现并验证

当前OpenSpec变更提案：
- ✅ `create-project-dashboard` - 已验证通过
- ✅ `create-project-detail` - 已验证通过
- ✅ `create-project-management` - 已验证通过
- ✅ `create-resource-heatmap` - 已验证通过
- ✅ `create-data-management` - 已验证通过
- ✅ `notification-system` - 已验证通过

## 设计理念

**极简主义联调指挥台**
- 不做复杂的研发全流程管理（DevOps）
- 只做排期可视化与资源调度
- 一切为了"按时上线"

**核心价值**
- 🎯 上帝视角 - 多项目聚合甘特图
- ⚡ 极速模式 - 双击编辑，实时保存
- 🔍 瓶颈识别 - 资源排期热力图
- 🤖 智能解析 - 一键导入排期数据

## 使用说明

### 管理员登录

为了确保系统的安全性和数据的完整性，系统提供了管理员登录功能。

#### 登录方式

1. 在页面右上角点击"登录"按钮
2. 输入管理员账号和密码
3. 点击"确定"完成登录

#### 权限说明

- **未登录用户**：仅可查看项目信息，无法进行增删改操作
- **已登录用户**：可进行所有操作，包括创建、编辑、删除项目和任务
- **管理员模式**：使用"一键登录"功能可快速进入管理员模式

#### 注意事项

- 登录信息仅在当前会话有效，刷新页面后需要重新登录
- 建议定期修改密码，确保账户安全
- 退出登录后，所有未保存的操作将会丢失

### 任务通知系统

系统内置智能任务提醒功能，帮助用户及时掌握任务进度，避免延期风险。

#### 通知触发规则

每个任务严格只发送2次通知，确保用户不会错过也不会被重复打扰：

1. **提前一天通知**
   - 触发时机：任务开始前一天 或 任务开始当天任意时间
   - 适用场景：如果前一天没打开网站，当天打开仍然会收到提前一天的提醒
   - 提醒内容：提醒用户任务即将开始，建议提前做好准备

2. **当天提醒**
   - 触发时机：任务开始当天任意时间（不再受时间窗口限制）
   - 适用场景：确保当天任何时候打开网站都能收到提醒
   - 提醒内容：提醒用户任务已开始，建议立即开始工作

#### 通知管理

##### 查看通知

- 页面右上角通知图标显示未读通知数量（红色圆点）
- 点击通知图标打开通知下拉列表
- 列表按时间倒序排列，最新通知在最上方

##### 标记已读

- 点击通知卡片即可标记为已读
- 已读通知不再显示未读红点
- 标记已读后通知仍然保留在列表中

##### 删除通知

- 每条通知右上角有删除按钮（垃圾桶图标）
- 点击删除按钮可删除该通知
- 删除后的通知无法恢复

#### 通知内容说明

每条通知包含以下信息：

- **任务名称**：当前任务的具体名称
- **项目名称**：任务所属的项目名称
- **开始时间**：任务开始日期（格式：YYYY-MM-DD）
- **提醒类型**：前一天提醒 / 当天提醒
- **提醒时间**：通知生成的具体时间

#### 技术说明

- **检查频率**：系统每分钟检查一次任务通知，确保及时提醒
- **时区处理**：所有时间基于北京时区（UTC+8）
- **数据持久化**：通知信息保存在浏览器 localStorage 中，刷新页面后不会丢失
- **自动清理**：7天前的已确认通知会自动清理，避免数据无限增长
- **智能去重**：根据 taskId + remindTime 去重，确保每个任务只发送2次通知
- **无时间窗口限制**：当天提醒可在任意时间触发，确保用户不会错过

### 项目状态管理

系统支持项目状态的灵活切换，适应不同的项目阶段需求。

#### 状态类型

1. **进行中**：项目正在正常执行，在甘特图中正常显示
2. **已完成**：项目已完成，在甘特图中正常显示
3. **暂停**：项目暂时停止，不在首页甘特图中显示

#### 状态切换

1. 进入项目详情页
2. 点击"编辑"按钮打开编辑弹窗
3. 在"状态"下拉框中选择新状态
4. 点击"确定"保存更改

#### 注意事项

- 暂停项目在首页甘特图中隐藏，但可在项目管理页面查看
- AI全局分析会自动排除暂停和已完成项目
- 单项目分析支持所有状态的项目
- 状态变更会自动记录历史操作

### AI配置管理

系统支持AI功能的配置持久化，避免重新部署后配置丢失。

#### 配置项

1. **系统提示词**：AI分析时使用的系统级提示词
2. **服务提供商**：使用的AI服务提供商（如豆包、DeepSeek、Kimi等）

#### 配置方式

AI配置目前通过后端API进行管理，配置信息持久化到数据库，无需手动配置。

#### 注意事项

- 配置修改后无需重启服务，立即生效
- 建议定期备份配置，防止意外丢失
- AI分析功能需要有效的API密钥

### 历史操作记录

系统自动记录所有重要的操作变更，支持历史追溯。

#### 记录范围

以下操作会自动生成历史记录：

1. **项目操作**：创建、更新、删除项目
2. **任务操作**：创建、更新、删除任务
3. **状态变更**：项目状态、任务状态变更

#### 查看历史

历史记录保存在数据库中，可通过数据管理页面查看（功能开发中）。

#### 记录内容

每条历史记录包含以下信息：

- **操作类型**：创建、更新、删除
- **操作对象**：项目、任务
- **操作时间**：精确到秒的时间戳
- **操作者**：当前登录用户
- **变更详情**：修改前后的数据对比

## 许可证

MIT